import{d as O,u as E,c as u,b as e,t,a as l,F as I,r as A,n as p,o as c,_ as T,f as k,g as x,w as z,h as G,i as J,D as Q,e as R,j as M,v as U,q as W,k as H,s as X,x as Y,y as Z,z as ee,l as te,m as P,A as se,p as le}from"./index-yfqIqcdV.js";const ne={class:"rule-list"},ae={key:0,class:"data-table"},oe={class:"rule-name"},ie=["onClick"],re={class:"actions-cell"},ce=["onClick"],de=["onClick"],ue={key:1,class:"empty-state"},ve=O({__name:"AlertRuleList",props:{rules:{}},emits:["edit","delete","toggleStatus"],setup(b,{emit:h}){const d=h,{t:m}=E(),i=n=>n;return(n,r)=>(c(),u("div",ne,[b.rules.length?(c(),u("table",ae,[r[0]||(r[0]=e("colgroup",null,[e("col",{style:{width:"22%"}}),e("col",{style:{width:"15%"}}),e("col",{style:{width:"14%"}}),e("col",{style:{width:"14%"}}),e("col",{style:{width:"11%"}}),e("col",{style:{width:"10%"}}),e("col",{style:{width:"14%"}})],-1)),e("thead",null,[e("tr",null,[e("th",null,t(l(m)("alert.ruleName")),1),e("th",null,t(l(m)("alert.monitor")),1),e("th",null,t(l(m)("alert.metric")),1),e("th",null,t(l(m)("alert.threshold")),1),e("th",null,t(l(m)("alert.severity")),1),e("th",null,t(l(m)("alert.status")),1),e("th",null,t(l(m)("alert.actions")),1)])]),e("tbody",null,[(c(!0),u(I,null,A(b.rules,v=>(c(),u("tr",{key:v.id},[e("td",oe,t(v.name),1),e("td",null,t(v.monitorName),1),e("td",null,t(v.metricKey),1),e("td",null,[e("code",null,t(v.operator)+" "+t(v.threshold)+t(v.unit),1)]),e("td",null,[e("span",{class:p(["severity-badge",i(v.severity)])},t(l(m)(`alert.${v.severity}`)),3)]),e("td",null,[e("button",{class:p(["toggle-btn",v.status]),onClick:$=>d("toggleStatus",v.id,v.status==="enabled"?"disabled":"enabled")},t(l(m)(`alert.${v.status}`)),11,ie)]),e("td",re,[e("button",{class:"action-btn edit",onClick:$=>d("edit",v)},t(l(m)("action.edit")),9,ce),e("button",{class:"action-btn delete",onClick:$=>d("delete",v.id)},t(l(m)("action.delete")),9,de)])]))),128))])])):(c(),u("div",ue,t(l(m)("alert.noRules")),1))]))}}),me=T(ve,[["__scopeId","data-v-be0c4061"]]),he={class:"rule-form"},_e={class:"form-section"},pe={class:"section-title"},ye={class:"form-item"},fe=["placeholder"],ge={class:"form-section"},be={class:"section-title"},$e={class:"form-item"},ke={class:"searchable-select"},we={key:0,class:"select-dropdown"},Ce=["placeholder"],Ie={class:"select-options"},Ae=["onClick"],Re={key:0,class:"select-empty"},Me={class:"form-row"},xe={class:"form-item"},Ke=["value"],Se={class:"form-item"},Ne=["value"],De={class:"form-item"},Oe={class:"form-section"},Ee={class:"section-title"},Te={class:"pill-group"},Le=["onClick"],Ve={key:0,class:"form-section"},Fe={class:"section-title"},je={class:"channel-cards"},Be=["onClick"],Ue={class:"channel-icon"},Pe={class:"channel-info"},ze={class:"channel-name"},qe={class:"channel-type"},He={class:"toggle-indicator"},Ge=O({__name:"AlertRuleForm",props:{visible:{type:Boolean},rule:{},channels:{},monitors:{}},emits:["close","save"],setup(b,{emit:h}){const d=b,m=h,{t:i}=E(),n=k({name:"",monitorId:"",monitorName:"",metricKey:"latency",operator:">",threshold:0,unit:"ms",severity:"warning",status:"enabled",channelIds:[]}),r=x(()=>!!d.rule);z(()=>d.visible,a=>{a&&d.rule?n.value={name:d.rule.name,monitorId:d.rule.monitorId,monitorName:d.rule.monitorName,metricKey:d.rule.metricKey,operator:d.rule.operator,threshold:d.rule.threshold,unit:d.rule.unit,severity:d.rule.severity,status:d.rule.status,channelIds:[...d.rule.channelIds]}:a&&(n.value={name:"",monitorId:"",monitorName:"",metricKey:"latency",operator:">",threshold:0,unit:"ms",severity:"warning",status:"enabled",channelIds:[]}),g.value=!1,y.value=""});const v=["latency","uptime","successRate","avgDuration","throughput","errorRate"],$=x(()=>{var a;if(n.value.monitorId){const o=d.monitors.find(s=>s.id===n.value.monitorId);if((a=o==null?void 0:o.metricKeys)!=null&&a.length)return o.metricKeys}return v});z(()=>n.value.monitorId,()=>{$.value.includes(n.value.metricKey)||(n.value.metricKey=$.value[0]||"latency")});const w=[">","<",">=","<=","=="],N=["critical","warning","info"],K={critical:"#ff4d4f",warning:"#faad14",info:"#1890ff"},S=x(()=>d.channels.filter(a=>a.enabled)),y=k(""),g=k(!1),D=k(null),C=x(()=>{const a=y.value.toLowerCase();return a?d.monitors.filter(o=>i(o.nameKey).toLowerCase().includes(a)):d.monitors}),L=x(()=>{const a=d.monitors.find(o=>o.id===n.value.monitorId);return a?i(a.nameKey):""}),V=()=>{g.value=!0,y.value="",Y(()=>{var a;return(a=D.value)==null?void 0:a.focus()})},F=a=>{n.value.monitorId=a.id,n.value.monitorName=i(a.nameKey),g.value=!1,y.value=""},j=a=>{const o=n.value.channelIds.indexOf(a);o===-1?n.value.channelIds.push(a):n.value.channelIds.splice(o,1)},B=a=>a==="feishu"?"ðŸ’¬":a==="webhook"?"ðŸ”—":"âœ‰ï¸",_={mounted(a,o){a._clickOutside=s=>{a.contains(s.target)||o.value()},document.addEventListener("click",a._clickOutside)},unmounted(a){document.removeEventListener("click",a._clickOutside)}},f=()=>{n.value.name.trim()&&m("save",{...n.value})};return(a,o)=>(c(),G(Q,{visible:b.visible,title:r.value?l(i)("alert.editRule"):l(i)("alert.addRule"),width:"480px",onClose:o[6]||(o[6]=s=>m("close")),onConfirm:f},{default:J(()=>[e("div",he,[e("div",_e,[e("div",pe,t(l(i)("alert.basic")),1),e("div",ye,[e("label",null,t(l(i)("alert.ruleName")),1),M(e("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>n.value.name=s),type:"text",class:"input",placeholder:l(i)("alert.ruleName")},null,8,fe),[[U,n.value.name]])])]),e("div",ge,[e("div",be,t(l(i)("alert.condition")),1),e("div",$e,[e("label",null,t(l(i)("alert.monitor")),1),M((c(),u("div",ke,[e("div",{class:"select-trigger input",onClick:V},[e("span",{class:p({placeholder:!n.value.monitorId})},t(L.value||"Select..."),3),o[7]||(o[7]=e("span",{class:"select-arrow"},"â–¾",-1))]),g.value?(c(),u("div",we,[M(e("input",{ref_key:"monitorSearchInput",ref:D,"onUpdate:modelValue":o[1]||(o[1]=s=>y.value=s),type:"text",class:"search-input",placeholder:l(i)("action.search"),onClick:o[2]||(o[2]=W(()=>{},["stop"]))},null,8,Ce),[[U,y.value]]),e("div",Ie,[(c(!0),u(I,null,A(C.value,s=>(c(),u("div",{key:s.id,class:p(["select-option",{active:n.value.monitorId===s.id}]),onClick:q=>F(s)},t(l(i)(s.nameKey)),11,Ae))),128)),C.value.length?R("",!0):(c(),u("div",Re,t(l(i)("form.noMatches")),1))])])):R("",!0)])),[[_,()=>g.value=!1]])]),e("div",Me,[e("div",xe,[e("label",null,t(l(i)("alert.metric")),1),M(e("select",{"onUpdate:modelValue":o[3]||(o[3]=s=>n.value.metricKey=s),class:"input"},[(c(!0),u(I,null,A($.value,s=>(c(),u("option",{key:s,value:s},t(l(i)(`metric.${s}`)),9,Ke))),128))],512),[[H,n.value.metricKey]])]),e("div",Se,[e("label",null,t(l(i)("alert.operator")),1),M(e("select",{"onUpdate:modelValue":o[4]||(o[4]=s=>n.value.operator=s),class:"input"},[(c(),u(I,null,A(w,s=>e("option",{key:s,value:s},t(s),9,Ne)),64))],512),[[H,n.value.operator]])]),e("div",De,[e("label",null,t(l(i)("alert.threshold")),1),M(e("input",{"onUpdate:modelValue":o[5]||(o[5]=s=>n.value.threshold=s),type:"number",class:"input"},null,512),[[U,n.value.threshold,void 0,{number:!0}]])])])]),e("div",Oe,[e("div",Ee,t(l(i)("alert.severity")),1),e("div",Te,[(c(),u(I,null,A(N,s=>e("button",{key:s,class:p(["pill",{active:n.value.severity===s}]),style:X(n.value.severity===s?{background:K[s],borderColor:K[s],color:"#fff"}:{}),onClick:q=>n.value.severity=s},t(l(i)(`alert.${s}`)),15,Le)),64))])]),S.value.length?(c(),u("div",Ve,[e("div",Fe,t(l(i)("alert.notification")),1),e("div",je,[(c(!0),u(I,null,A(S.value,s=>(c(),u("div",{key:s.id,class:p(["channel-card",{selected:n.value.channelIds.includes(s.id)}]),onClick:q=>j(s.id)},[e("span",Ue,t(B(s.type)),1),e("div",Pe,[e("span",ze,t(s.name),1),e("span",qe,t(l(i)(`alert.${s.type}`)),1)]),e("div",He,[e("div",{class:p(["toggle-track",{on:n.value.channelIds.includes(s.id)}])},[...o[8]||(o[8]=[e("div",{class:"toggle-thumb"},null,-1)])],2)])],10,Be))),128))])])):R("",!0)])]),_:1},8,["visible","title"]))}}),Je=T(Ge,[["__scopeId","data-v-27d41ad6"]]),Qe={class:"alert-history"},We={key:0,class:"timeline"},Xe={class:"timeline-track"},Ye={key:0,class:"timeline-line"},Ze={class:"card-header"},et={class:"header-left"},tt={class:"rule-name"},st={class:"time-ago"},lt={class:"card-message"},nt={class:"card-details"},at={class:"detail-item"},ot={class:"detail-label"},it={class:"detail-value"},rt={class:"detail-item"},ct={class:"detail-label"},dt={class:"detail-item"},ut={class:"detail-label"},vt={class:"detail-value"},mt={class:"card-times"},ht={key:0},_t={key:1,class:"empty-state"},pt=O({__name:"AlertHistory",props:{events:{}},setup(b){const{t:h}=E(),d=i=>i.replace("T"," ").substring(0,19),m=i=>{const n=Date.now()-new Date(i).getTime(),r=Math.floor(n/6e4);if(r<60)return`${r}m ago`;const v=Math.floor(r/60);return v<24?`${v}h ago`:`${Math.floor(v/24)}d ago`};return(i,n)=>(c(),u("div",Qe,[b.events.length?(c(),u("div",We,[(c(!0),u(I,null,A(b.events,(r,v)=>(c(),u("div",{key:r.id,class:"timeline-item"},[e("div",Xe,[e("div",{class:p(["timeline-dot",r.severity])},null,2),v<b.events.length-1?(c(),u("div",Ye)):R("",!0)]),e("div",{class:p(["event-card",[r.severity,r.status]])},[e("div",Ze,[e("div",et,[e("span",tt,t(r.ruleName),1),e("span",{class:p(["severity-badge",r.severity])},t(l(h)(`alert.${r.severity}`)),3),e("span",{class:p(["status-badge",r.status])},t(l(h)(`alert.${r.status}`)),3)]),e("span",st,t(m(r.firedAt)),1)]),e("div",lt,t(r.message),1),e("div",nt,[e("div",at,[e("span",ot,t(l(h)("alert.monitor")),1),e("span",it,t(r.monitorName),1)]),e("div",rt,[e("span",ct,t(l(h)("alert.value")),1),e("span",{class:p(["detail-value value-highlight",r.severity])},t(r.value),3)]),e("div",dt,[e("span",ut,t(l(h)("alert.threshold")),1),e("span",vt,t(r.threshold),1)])]),e("div",mt,[e("span",null,t(l(h)("alert.firedAt"))+": "+t(d(r.firedAt)),1),r.resolvedAt?(c(),u("span",ht,t(l(h)("alert.resolvedAt"))+": "+t(d(r.resolvedAt)),1)):R("",!0)])],2)]))),128))])):(c(),u("div",_t,t(l(h)("alert.noEvents")),1))]))}}),yt=T(pt,[["__scopeId","data-v-e0b8cf88"]]),ft={class:"alert-management"},gt={class:"tab-bar"},bt={key:0,class:"tab-content"},$t={class:"tab-toolbar"},kt={key:1,class:"tab-content"},wt=O({__name:"AlertManagement",setup(b){const{t:h}=E(),{getAlertRules:d,createAlertRule:m,updateAlertRule:i,deleteAlertRule:n,getAlertChannels:r,getAlertEvents:v}=le(),{activeProjectId:$}=ee(),w=k("rules"),N=k([]),K=k([]),S=k([]),y=k(!1),g=k(null),D=x(()=>Z($.value)),C=async()=>{const _=se($.value),f=(await d()).value;N.value=f.filter(o=>_.has(o.monitorId)),K.value=(await r()).value;const a=(await v()).value;S.value=a.filter(o=>_.has(o.monitorId))};te(C),z($,C);const L=()=>{g.value=null,y.value=!0},V=_=>{g.value=_,y.value=!0},F=async _=>{g.value?await i(g.value.id,_):await m(_),y.value=!1,await C()},j=async(_,f)=>{await i(_,{status:f})},B=async _=>{await n(_),await C()};return(_,f)=>(c(),u("div",ft,[e("div",gt,[e("div",{class:p(["tab",{active:w.value==="rules"}]),onClick:f[0]||(f[0]=a=>w.value="rules")},t(l(h)("alert.rules")),3),e("div",{class:p(["tab",{active:w.value==="history"}]),onClick:f[1]||(f[1]=a=>w.value="history")},t(l(h)("alert.history")),3)]),w.value==="rules"?(c(),u("div",bt,[e("div",$t,[e("button",{class:"add-btn",onClick:L},"+ "+t(l(h)("alert.addRule")),1)]),P(me,{rules:N.value,onEdit:V,onDelete:B,onToggleStatus:j},null,8,["rules"])])):R("",!0),w.value==="history"?(c(),u("div",kt,[P(yt,{events:S.value},null,8,["events"])])):R("",!0),P(Je,{visible:y.value,rule:g.value,channels:K.value,monitors:D.value,onClose:f[2]||(f[2]=a=>y.value=!1),onSave:F},null,8,["visible","rule","channels","monitors"])]))}}),It=T(wt,[["__scopeId","data-v-edf62883"]]);export{It as default};
