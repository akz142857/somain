import{d as N,u as V,c as o,a as e,t,b as n,F as C,r as A,n as I,o as a,_ as U,f as g,g as L,w as j,h as O,i as P,M as H,e as D,j as w,v as K,k as M,l as Z,m as ee,p as te,q as le,s as F,x as se,y as ne}from"./index-Lw1zRu2w.js";const ae={class:"rule-list"},oe={key:0,class:"data-table"},ie={class:"rule-name"},re=["onClick"],ue={class:"actions-cell"},ce=["onClick"],de=["onClick"],ve={key:1,class:"empty-state"},me=N({__name:"AlertRuleList",props:{rules:{}},emits:["edit","delete","toggleStatus"],setup(h,{emit:m}){const r=m,{t:v}=V(),d=l=>l;return(l,p)=>(a(),o("div",ae,[h.rules.length?(a(),o("table",oe,[e("thead",null,[e("tr",null,[e("th",null,t(n(v)("alert.ruleName")),1),e("th",null,t(n(v)("alert.monitor")),1),e("th",null,t(n(v)("alert.metric")),1),e("th",null,t(n(v)("alert.threshold")),1),e("th",null,t(n(v)("alert.severity")),1),e("th",null,t(n(v)("alert.status")),1),e("th",null,t(n(v)("alert.actions")),1)])]),e("tbody",null,[(a(!0),o(C,null,A(h.rules,i=>(a(),o("tr",{key:i.id},[e("td",ie,t(i.name),1),e("td",null,t(i.monitorName),1),e("td",null,t(i.metricKey),1),e("td",null,[e("code",null,t(i.operator)+" "+t(i.threshold)+t(i.unit),1)]),e("td",null,[e("span",{class:I(["severity-badge",d(i.severity)])},t(n(v)(`alert.${i.severity}`)),3)]),e("td",null,[e("button",{class:I(["toggle-btn",i.status]),onClick:_=>r("toggleStatus",i.id,i.status==="enabled"?"disabled":"enabled")},t(n(v)(`alert.${i.status}`)),11,re)]),e("td",ue,[e("button",{class:"action-btn edit",onClick:_=>r("edit",i)},"Edit",8,ce),e("button",{class:"action-btn delete",onClick:_=>r("delete",i.id)},"Delete",8,de)])]))),128))])])):(a(),o("div",ve,t(n(v)("alert.noRules")),1))]))}}),he=U(me,[["__scopeId","data-v-e5baa579"]]),_e={class:"form-grid"},pe={class:"form-item"},ye={class:"form-item"},be=["value"],fe={class:"form-row"},$e={class:"form-item"},ge=["value"],ke={class:"form-item"},Ce=["value"],Ae={class:"form-item"},Ie={class:"form-item"},we=["value"],Re={key:0,class:"form-item"},xe={class:"channel-checks"},Se=["checked","onChange"],Ne=N({__name:"AlertRuleForm",props:{visible:{type:Boolean},rule:{},channels:{},monitors:{}},emits:["close","save"],setup(h,{emit:m}){const r=h,v=m,{t:d}=V(),l=g({name:"",monitorId:"",monitorName:"",metricKey:"latency",operator:">",threshold:0,unit:"ms",severity:"warning",status:"enabled",channelIds:[]}),p=L(()=>!!r.rule);j(()=>r.visible,u=>{u&&r.rule?l.value={name:r.rule.name,monitorId:r.rule.monitorId,monitorName:r.rule.monitorName,metricKey:r.rule.metricKey,operator:r.rule.operator,threshold:r.rule.threshold,unit:r.rule.unit,severity:r.rule.severity,status:r.rule.status,channelIds:[...r.rule.channelIds]}:u&&(l.value={name:"",monitorId:"",monitorName:"",metricKey:"latency",operator:">",threshold:0,unit:"ms",severity:"warning",status:"enabled",channelIds:[]})});const i=["latency","uptime","successRate","avgDuration","throughput","errorRate"],_=[">","<",">=","<=","=="],k=["critical","warning","info"],R=()=>{const u=r.monitors.find(c=>c.id===l.value.monitorId);u&&(l.value.monitorName=u.name)},f=u=>{const c=l.value.channelIds.indexOf(u);c===-1?l.value.channelIds.push(u):l.value.channelIds.splice(c,1)},$=()=>{l.value.name.trim()&&v("save",{...l.value})};return(u,c)=>(a(),O(H,{visible:h.visible,title:p.value?n(d)("alert.editRule"):n(d)("alert.addRule"),onClose:c[6]||(c[6]=s=>v("close")),onConfirm:$},{default:P(()=>[e("div",_e,[e("div",pe,[e("label",null,t(n(d)("alert.ruleName")),1),w(e("input",{"onUpdate:modelValue":c[0]||(c[0]=s=>l.value.name=s),type:"text",class:"input"},null,512),[[K,l.value.name]])]),e("div",ye,[e("label",null,t(n(d)("alert.monitor")),1),w(e("select",{"onUpdate:modelValue":c[1]||(c[1]=s=>l.value.monitorId=s),class:"input",onChange:R},[c[7]||(c[7]=e("option",{value:"",disabled:""},"Select...",-1)),(a(!0),o(C,null,A(h.monitors,s=>(a(),o("option",{key:s.id,value:s.id},t(s.name),9,be))),128))],544),[[M,l.value.monitorId]])]),e("div",fe,[e("div",$e,[e("label",null,t(n(d)("alert.metric")),1),w(e("select",{"onUpdate:modelValue":c[2]||(c[2]=s=>l.value.metricKey=s),class:"input"},[(a(),o(C,null,A(i,s=>e("option",{key:s,value:s},t(s),9,ge)),64))],512),[[M,l.value.metricKey]])]),e("div",ke,[e("label",null,t(n(d)("alert.operator")),1),w(e("select",{"onUpdate:modelValue":c[3]||(c[3]=s=>l.value.operator=s),class:"input"},[(a(),o(C,null,A(_,s=>e("option",{key:s,value:s},t(s),9,Ce)),64))],512),[[M,l.value.operator]])]),e("div",Ae,[e("label",null,t(n(d)("alert.threshold")),1),w(e("input",{"onUpdate:modelValue":c[4]||(c[4]=s=>l.value.threshold=s),type:"number",class:"input"},null,512),[[K,l.value.threshold,void 0,{number:!0}]])])]),e("div",Ie,[e("label",null,t(n(d)("alert.severity")),1),w(e("select",{"onUpdate:modelValue":c[5]||(c[5]=s=>l.value.severity=s),class:"input"},[(a(),o(C,null,A(k,s=>e("option",{key:s,value:s},t(n(d)(`alert.${s}`)),9,we)),64))],512),[[M,l.value.severity]])]),h.channels.length?(a(),o("div",Re,[e("label",null,t(n(d)("alert.notifyChannels")),1),e("div",xe,[(a(!0),o(C,null,A(h.channels,s=>(a(),o("label",{key:s.id,class:"check-label"},[e("input",{type:"checkbox",checked:l.value.channelIds.includes(s.id),onChange:S=>f(s.id)},null,40,Se),Z(" "+t(s.name),1)]))),128))])])):D("",!0)])]),_:1},8,["visible","title"]))}}),Ve=U(Ne,[["__scopeId","data-v-75c0948f"]]),Ue={class:"channel-list"},Fe={key:0,class:"channel-grid"},Me={class:"channel-header"},De={class:"channel-name"},Te={class:"channel-config"},Ee={class:"channel-footer"},je={class:"channel-date"},Ke=["onClick"],Be={key:1,class:"empty-state"},Le=N({__name:"AlertChannelList",props:{channels:{}},emits:["delete"],setup(h,{emit:m}){const r=m,{t:v}=V(),d=p=>p,l=p=>{const i=Object.entries(p.config);return i.length===0?"-":i.map(([_,k])=>`${_}: ${k.length>30?k.slice(0,30)+"...":k}`).join(", ")};return(p,i)=>(a(),o("div",Ue,[h.channels.length?(a(),o("div",Fe,[(a(!0),o(C,null,A(h.channels,_=>(a(),o("div",{key:_.id,class:"channel-card"},[e("div",Me,[e("span",De,t(_.name),1),e("span",{class:I(["type-badge",d(_.type)])},t(n(v)(`alert.${_.type}`)),3)]),e("div",Te,t(l(_)),1),e("div",Ee,[e("span",je,t(_.createdAt.split("T")[0]),1),e("button",{class:"delete-btn",onClick:k=>r("delete",_.id)},"Delete",8,Ke)])]))),128))])):(a(),o("div",Be,t(n(v)("alert.noChannels")),1))]))}}),Oe=U(Le,[["__scopeId","data-v-3181dd53"]]),Pe={class:"form-grid"},He={class:"form-item"},qe={class:"form-item"},ze=["value"],Ge=["onUpdate:modelValue"],Je=N({__name:"AlertChannelForm",props:{visible:{type:Boolean}},emits:["close","save"],setup(h,{emit:m}){const r=h,v=m,{t:d}=V(),l=g(""),p=g("feishu"),i=g({}),_=["feishu","webhook","email"],k=L(()=>{switch(p.value){case"feishu":return[{key:"webhookUrl",label:d("alert.webhookUrl")}];case"webhook":return[{key:"url",label:"URL"},{key:"secret",label:"Secret"}];case"email":return[{key:"emailAddress",label:d("alert.emailAddress")}];default:return[]}});j(()=>r.visible,f=>{f&&(l.value="",p.value="feishu",i.value={})}),j(p,()=>{i.value={}});const R=()=>{l.value.trim()&&v("save",{name:l.value,type:p.value,config:{...i.value}})};return(f,$)=>(a(),O(H,{visible:h.visible,title:n(d)("alert.addChannel"),onClose:$[2]||($[2]=u=>v("close")),onConfirm:R},{default:P(()=>[e("div",Pe,[e("div",He,[e("label",null,t(n(d)("alert.channelName")),1),w(e("input",{"onUpdate:modelValue":$[0]||($[0]=u=>l.value=u),type:"text",class:"input"},null,512),[[K,l.value]])]),e("div",qe,[e("label",null,t(n(d)("alert.channelType")),1),w(e("select",{"onUpdate:modelValue":$[1]||($[1]=u=>p.value=u),class:"input"},[(a(),o(C,null,A(_,u=>e("option",{key:u,value:u},t(n(d)(`alert.${u}`)),9,ze)),64))],512),[[M,p.value]])]),(a(!0),o(C,null,A(k.value,u=>(a(),o("div",{key:u.key,class:"form-item"},[e("label",null,t(u.label),1),w(e("input",{"onUpdate:modelValue":c=>i.value[u.key]=c,type:"text",class:"input"},null,8,Ge),[[K,i.value[u.key]]])]))),128))])]),_:1},8,["visible","title"]))}}),Qe=U(Je,[["__scopeId","data-v-a8a31b5f"]]),We={class:"alert-history"},Xe={key:0,class:"timeline"},Ye={class:"timeline-content"},Ze={class:"timeline-header"},et={class:"timeline-rule"},tt={class:"timeline-message"},lt={class:"timeline-meta"},st={class:"timeline-times"},nt={key:0},at={key:1,class:"empty-state"},ot=N({__name:"AlertHistory",props:{events:{}},setup(h){const{t:m}=V(),r=v=>v.replace("T"," ").substring(0,19);return(v,d)=>(a(),o("div",We,[h.events.length?(a(),o("div",Xe,[(a(!0),o(C,null,A(h.events,l=>(a(),o("div",{key:l.id,class:I(["timeline-item",l.status])},[e("div",{class:I(["timeline-dot",l.severity])},null,2),e("div",Ye,[e("div",Ze,[e("span",{class:I(["severity-badge",l.severity])},t(n(m)(`alert.${l.severity}`)),3),e("span",{class:I(["status-badge",l.status])},t(n(m)(`alert.${l.status}`)),3),e("span",et,t(l.ruleName),1)]),e("div",tt,t(l.message),1),e("div",lt,[e("span",null,t(n(m)("alert.monitor"))+": "+t(l.monitorName),1),e("span",null,t(n(m)("alert.value"))+": "+t(l.value)+" | "+t(n(m)("alert.threshold"))+": "+t(l.threshold),1)]),e("div",st,[e("span",null,t(n(m)("alert.firedAt"))+": "+t(r(l.firedAt)),1),l.resolvedAt?(a(),o("span",nt,t(n(m)("alert.resolvedAt"))+": "+t(r(l.resolvedAt)),1)):D("",!0)])])],2))),128))])):(a(),o("div",at,t(n(m)("alert.noEvents")),1))]))}}),it=U(ot,[["__scopeId","data-v-7772c72d"]]),rt={class:"alert-management"},ut={class:"tab-bar"},ct={key:0,class:"tab-content"},dt={class:"tab-toolbar"},vt={key:1,class:"tab-content"},mt={class:"tab-toolbar"},ht={key:2,class:"tab-content"},_t=N({__name:"AlertManagement",setup(h){const{t:m}=V(),{getAlertRules:r,createAlertRule:v,updateAlertRule:d,deleteAlertRule:l,getAlertChannels:p,createAlertChannel:i,deleteAlertChannel:_,getAlertEvents:k}=ne(),{activeProjectId:R}=te(),f=g("rules"),$=g([]),u=g([]),c=g([]),s=g(!1),S=g(null),T=g(!1),q=L(()=>ee(R.value)),E=async()=>{const y=se(R.value),b=(await r()).value;$.value=b.filter(B=>y.has(B.monitorId)),u.value=(await p()).value;const x=(await k()).value;c.value=x.filter(B=>y.has(B.monitorId))};le(E),j(R,E);const z=()=>{S.value=null,s.value=!0},G=y=>{S.value=y,s.value=!0},J=async y=>{S.value?await d(S.value.id,y):await v(y),s.value=!1,await E()},Q=async(y,b)=>{await d(y,{status:b})},W=async y=>{await l(y),await E()},X=async y=>{await i(y),T.value=!1},Y=async y=>{await _(y)};return(y,b)=>(a(),o("div",rt,[e("div",ut,[e("div",{class:I(["tab",{active:f.value==="rules"}]),onClick:b[0]||(b[0]=x=>f.value="rules")},t(n(m)("alert.rules")),3),e("div",{class:I(["tab",{active:f.value==="channels"}]),onClick:b[1]||(b[1]=x=>f.value="channels")},t(n(m)("alert.channels")),3),e("div",{class:I(["tab",{active:f.value==="history"}]),onClick:b[2]||(b[2]=x=>f.value="history")},t(n(m)("alert.history")),3)]),f.value==="rules"?(a(),o("div",ct,[e("div",dt,[e("button",{class:"add-btn",onClick:z},"+ "+t(n(m)("alert.addRule")),1)]),F(he,{rules:$.value,onEdit:G,onDelete:W,onToggleStatus:Q},null,8,["rules"])])):D("",!0),f.value==="channels"?(a(),o("div",vt,[e("div",mt,[e("button",{class:"add-btn",onClick:b[3]||(b[3]=x=>T.value=!0)},"+ "+t(n(m)("alert.addChannel")),1)]),F(Oe,{channels:u.value,onDelete:Y},null,8,["channels"])])):D("",!0),f.value==="history"?(a(),o("div",ht,[F(it,{events:c.value},null,8,["events"])])):D("",!0),F(Ve,{visible:s.value,rule:S.value,channels:u.value,monitors:q.value,onClose:b[4]||(b[4]=x=>s.value=!1),onSave:J},null,8,["visible","rule","channels","monitors"]),F(Qe,{visible:T.value,onClose:b[5]||(b[5]=x=>T.value=!1),onSave:X},null,8,["visible"])]))}}),yt=U(_t,[["__scopeId","data-v-db8adcb3"]]);export{yt as default};
