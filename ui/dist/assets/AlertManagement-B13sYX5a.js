import{d as K,u as E,c as u,b as e,t,a as l,F as C,r as I,n as p,o as c,_ as O,f as b,g as N,w as q,h as H,i as G,D as J,e as A,j as M,v as B,q as Q,k as z,s as W,x as X,y as Y,z as Z,l as ee,m as U,A as te,p as se}from"./index-Cixa8nzu.js";const le={class:"rule-list"},ne={key:0,class:"data-table"},ae={class:"rule-name"},oe=["onClick"],ie={class:"actions-cell"},re=["onClick"],ce=["onClick"],de={key:1,class:"empty-state"},ue=K({__name:"AlertRuleList",props:{rules:{}},emits:["edit","delete","toggleStatus"],setup(f,{emit:h}){const d=h,{t:m}=E(),i=a=>a;return(a,r)=>(c(),u("div",le,[f.rules.length?(c(),u("table",ne,[r[0]||(r[0]=e("colgroup",null,[e("col",{style:{width:"22%"}}),e("col",{style:{width:"15%"}}),e("col",{style:{width:"14%"}}),e("col",{style:{width:"14%"}}),e("col",{style:{width:"11%"}}),e("col",{style:{width:"10%"}}),e("col",{style:{width:"14%"}})],-1)),e("thead",null,[e("tr",null,[e("th",null,t(l(m)("alert.ruleName")),1),e("th",null,t(l(m)("alert.monitor")),1),e("th",null,t(l(m)("alert.metric")),1),e("th",null,t(l(m)("alert.threshold")),1),e("th",null,t(l(m)("alert.severity")),1),e("th",null,t(l(m)("alert.status")),1),e("th",null,t(l(m)("alert.actions")),1)])]),e("tbody",null,[(c(!0),u(C,null,I(f.rules,v=>(c(),u("tr",{key:v.id},[e("td",ae,t(v.name),1),e("td",null,t(v.monitorName),1),e("td",null,t(v.metricKey),1),e("td",null,[e("code",null,t(v.operator)+" "+t(v.threshold)+t(v.unit),1)]),e("td",null,[e("span",{class:p(["severity-badge",i(v.severity)])},t(l(m)(`alert.${v.severity}`)),3)]),e("td",null,[e("button",{class:p(["toggle-btn",v.status]),onClick:$=>d("toggleStatus",v.id,v.status==="enabled"?"disabled":"enabled")},t(l(m)(`alert.${v.status}`)),11,oe)]),e("td",ie,[e("button",{class:"action-btn edit",onClick:$=>d("edit",v)},t(l(m)("action.edit")),9,re),e("button",{class:"action-btn delete",onClick:$=>d("delete",v.id)},t(l(m)("action.delete")),9,ce)])]))),128))])])):(c(),u("div",de,t(l(m)("alert.noRules")),1))]))}}),ve=O(ue,[["__scopeId","data-v-be0c4061"]]),me={class:"rule-form"},he={class:"form-section"},_e={class:"section-title"},pe={class:"form-item"},ye=["placeholder"],fe={class:"form-section"},be={class:"section-title"},ge={class:"form-item"},$e={class:"searchable-select"},ke={key:0,class:"select-dropdown"},we=["placeholder"],Ce={class:"select-options"},Ie=["onClick"],Ae={key:0,class:"select-empty"},Re={class:"form-row"},Me={class:"form-item"},xe=["value"],Se={class:"form-item"},Ne=["value"],De={class:"form-item"},Ke={class:"form-section"},Ee={class:"section-title"},Oe={class:"pill-group"},Te=["onClick"],Le={key:0,class:"form-section"},Ve={class:"section-title"},Fe={class:"channel-cards"},je=["onClick"],Be={class:"channel-icon"},Ue={class:"channel-info"},Pe={class:"channel-name"},ze={class:"channel-type"},qe={class:"toggle-indicator"},He=K({__name:"AlertRuleForm",props:{visible:{type:Boolean},rule:{},channels:{},monitors:{}},emits:["close","save"],setup(f,{emit:h}){const d=f,m=h,{t:i}=E(),a=b({name:"",monitorId:"",monitorName:"",metricKey:"latency",operator:">",threshold:0,unit:"ms",severity:"warning",status:"enabled",channelIds:[]}),r=N(()=>!!d.rule);q(()=>d.visible,n=>{n&&d.rule?a.value={name:d.rule.name,monitorId:d.rule.monitorId,monitorName:d.rule.monitorName,metricKey:d.rule.metricKey,operator:d.rule.operator,threshold:d.rule.threshold,unit:d.rule.unit,severity:d.rule.severity,status:d.rule.status,channelIds:[...d.rule.channelIds]}:n&&(a.value={name:"",monitorId:"",monitorName:"",metricKey:"latency",operator:">",threshold:0,unit:"ms",severity:"warning",status:"enabled",channelIds:[]}),y.value=!1,g.value=""});const v=["latency","uptime","successRate","avgDuration","throughput","errorRate"],$=[">","<",">=","<=","=="],k=["critical","warning","info"],x={critical:"#ff4d4f",warning:"#faad14",info:"#1890ff"},S=N(()=>d.channels.filter(n=>n.enabled)),g=b(""),y=b(!1),w=b(null),D=N(()=>{const n=g.value.toLowerCase();return n?d.monitors.filter(o=>i(o.nameKey).toLowerCase().includes(n)):d.monitors}),R=N(()=>{const n=d.monitors.find(o=>o.id===a.value.monitorId);return n?i(n.nameKey):""}),T=()=>{y.value=!0,g.value="",X(()=>{var n;return(n=w.value)==null?void 0:n.focus()})},L=n=>{a.value.monitorId=n.id,a.value.monitorName=i(n.nameKey),y.value=!1,g.value=""},V=n=>{const o=a.value.channelIds.indexOf(n);o===-1?a.value.channelIds.push(n):a.value.channelIds.splice(o,1)},F=n=>n==="feishu"?"ðŸ’¬":n==="webhook"?"ðŸ”—":"âœ‰ï¸",j={mounted(n,o){n._clickOutside=s=>{n.contains(s.target)||o.value()},document.addEventListener("click",n._clickOutside)},unmounted(n){document.removeEventListener("click",n._clickOutside)}},_=()=>{a.value.name.trim()&&m("save",{...a.value})};return(n,o)=>(c(),H(J,{visible:f.visible,title:r.value?l(i)("alert.editRule"):l(i)("alert.addRule"),width:"480px",onClose:o[6]||(o[6]=s=>m("close")),onConfirm:_},{default:G(()=>[e("div",me,[e("div",he,[e("div",_e,t(l(i)("alert.basic")),1),e("div",pe,[e("label",null,t(l(i)("alert.ruleName")),1),M(e("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>a.value.name=s),type:"text",class:"input",placeholder:l(i)("alert.ruleName")},null,8,ye),[[B,a.value.name]])])]),e("div",fe,[e("div",be,t(l(i)("alert.condition")),1),e("div",ge,[e("label",null,t(l(i)("alert.monitor")),1),M((c(),u("div",$e,[e("div",{class:"select-trigger input",onClick:T},[e("span",{class:p({placeholder:!a.value.monitorId})},t(R.value||"Select..."),3),o[7]||(o[7]=e("span",{class:"select-arrow"},"â–¾",-1))]),y.value?(c(),u("div",ke,[M(e("input",{ref_key:"monitorSearchInput",ref:w,"onUpdate:modelValue":o[1]||(o[1]=s=>g.value=s),type:"text",class:"search-input",placeholder:l(i)("action.search"),onClick:o[2]||(o[2]=Q(()=>{},["stop"]))},null,8,we),[[B,g.value]]),e("div",Ce,[(c(!0),u(C,null,I(D.value,s=>(c(),u("div",{key:s.id,class:p(["select-option",{active:a.value.monitorId===s.id}]),onClick:P=>L(s)},t(l(i)(s.nameKey)),11,Ie))),128)),D.value.length?A("",!0):(c(),u("div",Ae,t(l(i)("form.noMatches")),1))])])):A("",!0)])),[[j,()=>y.value=!1]])]),e("div",Re,[e("div",Me,[e("label",null,t(l(i)("alert.metric")),1),M(e("select",{"onUpdate:modelValue":o[3]||(o[3]=s=>a.value.metricKey=s),class:"input"},[(c(),u(C,null,I(v,s=>e("option",{key:s,value:s},t(l(i)(`metric.${s}`)),9,xe)),64))],512),[[z,a.value.metricKey]])]),e("div",Se,[e("label",null,t(l(i)("alert.operator")),1),M(e("select",{"onUpdate:modelValue":o[4]||(o[4]=s=>a.value.operator=s),class:"input"},[(c(),u(C,null,I($,s=>e("option",{key:s,value:s},t(s),9,Ne)),64))],512),[[z,a.value.operator]])]),e("div",De,[e("label",null,t(l(i)("alert.threshold")),1),M(e("input",{"onUpdate:modelValue":o[5]||(o[5]=s=>a.value.threshold=s),type:"number",class:"input"},null,512),[[B,a.value.threshold,void 0,{number:!0}]])])])]),e("div",Ke,[e("div",Ee,t(l(i)("alert.severity")),1),e("div",Oe,[(c(),u(C,null,I(k,s=>e("button",{key:s,class:p(["pill",{active:a.value.severity===s}]),style:W(a.value.severity===s?{background:x[s],borderColor:x[s],color:"#fff"}:{}),onClick:P=>a.value.severity=s},t(l(i)(`alert.${s}`)),15,Te)),64))])]),S.value.length?(c(),u("div",Le,[e("div",Ve,t(l(i)("alert.notification")),1),e("div",Fe,[(c(!0),u(C,null,I(S.value,s=>(c(),u("div",{key:s.id,class:p(["channel-card",{selected:a.value.channelIds.includes(s.id)}]),onClick:P=>V(s.id)},[e("span",Be,t(F(s.type)),1),e("div",Ue,[e("span",Pe,t(s.name),1),e("span",ze,t(l(i)(`alert.${s.type}`)),1)]),e("div",qe,[e("div",{class:p(["toggle-track",{on:a.value.channelIds.includes(s.id)}])},[...o[8]||(o[8]=[e("div",{class:"toggle-thumb"},null,-1)])],2)])],10,je))),128))])])):A("",!0)])]),_:1},8,["visible","title"]))}}),Ge=O(He,[["__scopeId","data-v-91f3ba82"]]),Je={class:"alert-history"},Qe={key:0,class:"timeline"},We={class:"timeline-track"},Xe={key:0,class:"timeline-line"},Ye={class:"card-header"},Ze={class:"header-left"},et={class:"rule-name"},tt={class:"time-ago"},st={class:"card-message"},lt={class:"card-details"},nt={class:"detail-item"},at={class:"detail-label"},ot={class:"detail-value"},it={class:"detail-item"},rt={class:"detail-label"},ct={class:"detail-item"},dt={class:"detail-label"},ut={class:"detail-value"},vt={class:"card-times"},mt={key:0},ht={key:1,class:"empty-state"},_t=K({__name:"AlertHistory",props:{events:{}},setup(f){const{t:h}=E(),d=i=>i.replace("T"," ").substring(0,19),m=i=>{const a=Date.now()-new Date(i).getTime(),r=Math.floor(a/6e4);if(r<60)return`${r}m ago`;const v=Math.floor(r/60);return v<24?`${v}h ago`:`${Math.floor(v/24)}d ago`};return(i,a)=>(c(),u("div",Je,[f.events.length?(c(),u("div",Qe,[(c(!0),u(C,null,I(f.events,(r,v)=>(c(),u("div",{key:r.id,class:"timeline-item"},[e("div",We,[e("div",{class:p(["timeline-dot",r.severity])},null,2),v<f.events.length-1?(c(),u("div",Xe)):A("",!0)]),e("div",{class:p(["event-card",[r.severity,r.status]])},[e("div",Ye,[e("div",Ze,[e("span",et,t(r.ruleName),1),e("span",{class:p(["severity-badge",r.severity])},t(l(h)(`alert.${r.severity}`)),3),e("span",{class:p(["status-badge",r.status])},t(l(h)(`alert.${r.status}`)),3)]),e("span",tt,t(m(r.firedAt)),1)]),e("div",st,t(r.message),1),e("div",lt,[e("div",nt,[e("span",at,t(l(h)("alert.monitor")),1),e("span",ot,t(r.monitorName),1)]),e("div",it,[e("span",rt,t(l(h)("alert.value")),1),e("span",{class:p(["detail-value value-highlight",r.severity])},t(r.value),3)]),e("div",ct,[e("span",dt,t(l(h)("alert.threshold")),1),e("span",ut,t(r.threshold),1)])]),e("div",vt,[e("span",null,t(l(h)("alert.firedAt"))+": "+t(d(r.firedAt)),1),r.resolvedAt?(c(),u("span",mt,t(l(h)("alert.resolvedAt"))+": "+t(d(r.resolvedAt)),1)):A("",!0)])],2)]))),128))])):(c(),u("div",ht,t(l(h)("alert.noEvents")),1))]))}}),pt=O(_t,[["__scopeId","data-v-e0b8cf88"]]),yt={class:"alert-management"},ft={class:"tab-bar"},bt={key:0,class:"tab-content"},gt={class:"tab-toolbar"},$t={key:1,class:"tab-content"},kt=K({__name:"AlertManagement",setup(f){const{t:h}=E(),{getAlertRules:d,createAlertRule:m,updateAlertRule:i,deleteAlertRule:a,getAlertChannels:r,getAlertEvents:v}=se(),{activeProjectId:$}=Z(),k=b("rules"),x=b([]),S=b([]),g=b([]),y=b(!1),w=b(null),D=N(()=>Y($.value)),R=async()=>{const _=te($.value),n=(await d()).value;x.value=n.filter(s=>_.has(s.monitorId)),S.value=(await r()).value;const o=(await v()).value;g.value=o.filter(s=>_.has(s.monitorId))};ee(R),q($,R);const T=()=>{w.value=null,y.value=!0},L=_=>{w.value=_,y.value=!0},V=async _=>{w.value?await i(w.value.id,_):await m(_),y.value=!1,await R()},F=async(_,n)=>{await i(_,{status:n})},j=async _=>{await a(_),await R()};return(_,n)=>(c(),u("div",yt,[e("div",ft,[e("div",{class:p(["tab",{active:k.value==="rules"}]),onClick:n[0]||(n[0]=o=>k.value="rules")},t(l(h)("alert.rules")),3),e("div",{class:p(["tab",{active:k.value==="history"}]),onClick:n[1]||(n[1]=o=>k.value="history")},t(l(h)("alert.history")),3)]),k.value==="rules"?(c(),u("div",bt,[e("div",gt,[e("button",{class:"add-btn",onClick:T},"+ "+t(l(h)("alert.addRule")),1)]),U(ve,{rules:x.value,onEdit:L,onDelete:j,onToggleStatus:F},null,8,["rules"])])):A("",!0),k.value==="history"?(c(),u("div",$t,[U(pt,{events:g.value},null,8,["events"])])):A("",!0),U(Ge,{visible:y.value,rule:w.value,channels:S.value,monitors:D.value,onClose:n[2]||(n[2]=o=>y.value=!1),onSave:V},null,8,["visible","rule","channels","monitors"])]))}}),Ct=O(kt,[["__scopeId","data-v-edf62883"]]);export{Ct as default};
