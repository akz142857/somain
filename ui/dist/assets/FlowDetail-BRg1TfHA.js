import{d as T,c as o,a as e,F as S,r as I,b as d,n as w,t,o as s,_ as x,u as N,e as i,f as V,g as j,h as m,i as G,j as R,k as q,l as J,m as Q}from"./index-D_8Syaah.js";const U={class:"flow-viz"},W={class:"flow-container"},X={key:0,class:"flow-connector"},Y=["onClick"],Z={class:"step-status"},ee={class:"step-content"},te={class:"step-name"},se={key:0,class:"step-duration"},oe=T({__name:"FlowVisualization",props:{steps:{},selectedIndex:{}},emits:["select"],setup(n,{emit:v}){const $=v,c=h=>{switch(h){case"ok":return"ðŸŸ¢";case"error":return"ðŸ”´";default:return"âšª"}};return(h,g)=>(s(),o("div",U,[e("div",W,[(s(!0),o(S,null,I(n.steps,(r,_)=>(s(),o(S,{key:_},[_>0?(s(),o("div",X,[...g[0]||(g[0]=[e("div",{class:"connector-line"},null,-1)])])):d("",!0),e("div",{class:w(["flow-step",[r.status,{selected:n.selectedIndex===_}]]),onClick:k=>$("select",_)},[e("div",Z,t(c(r.status)),1),e("div",ee,[e("div",te,t(r.name),1),r.duration?(s(),o("div",se,t(r.duration),1)):d("",!0)])],10,Y)],64))),128))])]))}}),le=x(oe,[["__scopeId","data-v-81861863"]]),ae={class:"step-detail"},ne={class:"detail-header"},ie={class:"detail-name"},ce={class:"detail-grid"},re={key:0,class:"detail-row"},de={class:"detail-label"},ue={class:"detail-value mono"},ve={key:1,class:"detail-row"},_e={class:"detail-label"},he={class:"detail-value"},fe={key:0,class:"threshold"},pe={key:2,class:"detail-row"},we={class:"detail-label"},me={class:"detail-value"},ke={key:3,class:"detail-row"},ye={class:"detail-label"},$e={class:"detail-value"},ge={key:4,class:"detail-row"},be={class:"detail-label"},Ce={class:"detail-value"},Se={key:5,class:"detail-row"},Ie={class:"detail-label"},De={class:"detail-value"},Ee={key:6,class:"detail-row error-row"},Re={class:"detail-label"},Te={class:"detail-value error-text"},xe=T({__name:"StepDetailPanel",props:{step:{}},setup(n){const{t:v}=N(),$=h=>{switch(h){case"ok":return"status-ok";case"error":return"status-error";default:return"status-pending"}},c=h=>{switch(h){case"ok":return"OK";case"error":return"ERROR";default:return"PENDING"}};return(h,g)=>(s(),o("div",ae,[e("div",ne,[e("span",ie,t(n.step.name),1),e("span",{class:w(["detail-status",$(n.step.status)])},t(c(n.step.status)),3)]),e("div",ce,[n.step.endpoint?(s(),o("div",re,[e("span",de,t(i(v)("flow.endpoint")),1),e("span",ue,t(n.step.endpoint),1)])):d("",!0),n.step.duration?(s(),o("div",ve,[e("span",_e,t(i(v)("flow.duration")),1),e("span",he,[V(t(n.step.duration)+" ",1),n.step.threshold?(s(),o("span",fe,"("+t(i(v)("flow.threshold"))+": "+t(n.step.threshold)+")",1)):d("",!0)])])):d("",!0),n.step.startedAt?(s(),o("div",pe,[e("span",we,t(i(v)("flow.startedAt")),1),e("span",me,t(n.step.startedAt),1)])):d("",!0),n.step.retries!==void 0?(s(),o("div",ke,[e("span",ye,t(i(v)("flow.retries")),1),e("span",$e,t(n.step.retries),1)])):d("",!0),n.step.throughput?(s(),o("div",ge,[e("span",be,t(i(v)("flow.throughput")),1),e("span",Ce,t(n.step.throughput),1)])):d("",!0),n.step.p99?(s(),o("div",Se,[e("span",Ie,t(i(v)("flow.p99")),1),e("span",De,t(n.step.p99),1)])):d("",!0),n.step.errorMessage?(s(),o("div",Ee,[e("span",Re,t(i(v)("flow.error")),1),e("span",Te,t(n.step.errorMessage),1)])):d("",!0)])]))}}),Fe=x(xe,[["__scopeId","data-v-aff0e3d3"]]),Le={key:0,class:"flow-detail"},Be={class:"page-header"},Me={class:"page-title"},Ne={key:0,class:"error-badge"},Ve={class:"section metrics-summary"},ze={class:"section-title"},Ae={class:"metrics-grid"},He={class:"metric-label"},Ke={key:0,class:"metric-card"},Oe={class:"metric-label"},Pe={class:"metric-value"},je={key:0,class:"section"},Ge={class:"history-bar"},qe=["onClick"],Je={class:"history-time"},Qe={class:"section"},Ue={class:"section-title"},We={key:1,class:"section"},Xe={class:"section-title"},Ye={key:2,class:"section hint"},Ze={class:"select-hint"},et={class:"section"},tt={class:"section-title"},st={class:"event-filters"},ot={class:"events-list"},lt={class:"event-time"},at={key:0,class:"event-id"},nt={class:"event-msg"},it={key:1,class:"event-status-tag"},ct={key:2,class:"event-status-tag ok"},rt={key:0,class:"empty-state"},dt={key:3,class:"section"},ut={class:"section-title"},vt={class:"agent-card"},_t={class:"agent-label"},ht={class:"agent-desc"},ft={key:0,class:"agent-confidence"},pt={key:1,class:"not-found"},wt=T({__name:"FlowDetail",setup(n){const v=j(),$=Q(),{t:c}=N(),{getMonitorById:h}=G(),g=v.params.monitorId,r=m(()=>h(g)),_=R(null),k=R(null),b=R("all"),F=["13:55","13:58","14:01","14:04","14:07","14:10","14:13","14:16","14:19","14:22"],z=l=>{const a=F[l]??"",f=F[l+1]??"14:25";return`${a}â€“${f}`},y=m(()=>{var l;return k.value===null||!((l=r.value)!=null&&l.historySnapshots)?null:r.value.historySnapshots[k.value]??null}),D=m(()=>{var l,a;return(l=y.value)!=null&&l.flowSteps?y.value.flowSteps:((a=r.value)==null?void 0:a.flowSteps)??[]}),A=m(()=>{var l,a;return(l=y.value)!=null&&l.events?y.value.events:((a=r.value)==null?void 0:a.events)??[]}),C=m(()=>{var l;return y.value?y.value.agent??null:((l=r.value)==null?void 0:l.agent)??null}),L=m(()=>_.value===null?null:D.value[_.value]??null),H=l=>{_.value=null,k.value=k.value===l?null:l},B=m(()=>{const l=A.value;return l.length?b.value==="errors"?l.filter(a=>{var f;return((f=a.flow)==null?void 0:f.some(u=>u.status==="error"))||a.msg.toLowerCase().includes("timeout")||a.msg.toLowerCase().includes("error")||a.msg.toLowerCase().includes("refused")}):l:[]}),K=l=>{_.value=_.value===l?null:l},M=()=>{$.push({name:"dashboard"})},O=l=>{var a;return(a=l.flow)!=null&&a.some(f=>f.status==="error")?"event-error":"event-ok"};return(l,a)=>{var f;return r.value?(s(),o("div",Le,[e("div",Be,[e("button",{class:"back-btn",onClick:M},[a[2]||(a[2]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})],-1)),V(" "+t(i(c)("flow.backToDashboard")),1)]),e("h1",Me,t(i(c)(r.value.nameKey)),1),r.value.status==="error"?(s(),o("span",Ne,t(i(c)("status.error")),1)):d("",!0)]),e("div",Ve,[e("div",ze,t(i(c)("flow.metricsTitle")),1),e("div",Ae,[(s(!0),o(S,null,I(r.value.metrics,(u,p)=>(s(),o("div",{key:p,class:"metric-card"},[e("span",He,t(i(c)(u.labelKey)),1),e("span",{class:w(["metric-value",u.status])},t(u.value),3)]))),128)),r.value.flowSteps?(s(),o("div",Ke,[e("span",Oe,t(i(c)("flow.steps")),1),e("span",Pe,t(r.value.flowSteps.length),1)])):d("",!0)])]),r.value.history?(s(),o("div",je,[e("div",Ge,[(s(!0),o(S,null,I(r.value.history,(u,p)=>(s(),o("div",{key:p,class:w(["history-item",{selected:k.value===p}]),onClick:E=>H(p)},[e("div",{class:w(["history-block",u])},null,2),e("span",Je,t(z(p)),1)],10,qe))),128))])])):d("",!0),e("div",Qe,[e("div",Ue,t(i(c)("flow.flowTitle")),1),D.value.length?(s(),q(le,{key:0,steps:D.value,"selected-index":_.value,onSelect:K},null,8,["steps","selected-index"])):d("",!0)]),L.value?(s(),o("div",We,[e("div",Xe,t(i(c)("flow.stepDetail")),1),J(Fe,{step:L.value},null,8,["step"])])):(s(),o("div",Ye,[e("div",Ze,t(i(c)("flow.selectStep")),1)])),e("div",et,[e("div",tt,t(i(c)("flow.eventsTitle")),1),e("div",st,[e("button",{class:w(["filter-btn",{active:b.value==="all"}]),onClick:a[0]||(a[0]=u=>b.value="all")},t(i(c)("flow.filterAll")),3),e("button",{class:w(["filter-btn",{active:b.value==="errors"}]),onClick:a[1]||(a[1]=u=>b.value="errors")},t(i(c)("flow.filterErrors")),3)]),e("div",ot,[(s(!0),o(S,null,I(B.value,(u,p)=>{var E;return s(),o("div",{key:p,class:w(["event-row",O(u)])},[e("span",lt,t(u.time),1),u.id?(s(),o("span",at,t(u.id),1)):d("",!0),e("span",nt,t(u.msg),1),(E=u.flow)!=null&&E.some(P=>P.status==="error")?(s(),o("span",it,"ERROR")):u.flow?(s(),o("span",ct,"OK")):d("",!0)],2)}),128)),B.value.length===0?(s(),o("div",rt,t(i(c)("flow.noEvents")),1)):d("",!0)])]),(f=C.value)!=null&&f.rootCause?(s(),o("div",dt,[e("div",ut,t(i(c)("flow.agentTitle")),1),e("div",vt,[e("div",_t,t(C.value.rootCause.title),1),e("div",ht,t(C.value.rootCause.desc),1),C.value.rootCause.confidence?(s(),o("div",ft,t(C.value.rootCause.confidence),1)):d("",!0)])])):d("",!0)])):(s(),o("div",pt,[a[3]||(a[3]=e("p",null,"Monitor not found.",-1)),e("button",{class:"back-btn",onClick:M},t(i(c)("flow.backToDashboard")),1)]))}}}),kt=x(wt,[["__scopeId","data-v-0d92d99e"]]);export{kt as default};
